# syntax=docker/dockerfile:1.4
# Dockerfile.test - Testing Environment
# Includes all dependencies for running tests (Jest, Playwright client)

FROM node:22-alpine

WORKDIR /app

ENV NODE_ENV=test
ENV NEXT_TELEMETRY_DISABLED=1
ENV PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD=1

# Install required system libs for some node modules
RUN apk add --no-cache git bash

COPY package.json package-lock.json* ./

# Install all dependencies (ci guarantees clean install)
RUN npm ci

COPY . .

# Run build if tests depend on built artifacts (optional, usually jest doesn't need full build)
# RUN npm run build

CMD ["npm", "run", "test:ci"]
