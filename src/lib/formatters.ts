/**
 * Sinesys - Formatadores de Dados Brasileiros
 *
 * ⚠️ Legado/Compat:
 * - O “single source of truth” de formatação é o Design System em `@/lib/design-system`.
 * - Mantemos este módulo como compatibilidade (assinaturas/semântica antigas),
 *   para não quebrar telas que esperam `''` ao invés de `'-'` em campos vazios.
 *
 * REGRA PARA AGENTES:
 * SEMPRE importe e use essas funções ao exibir dados para o usuário.
 * NUNCA crie lógica de formatação inline nos componentes.
 */

import {
  formatCurrency as dsFormatCurrency,
  formatCPF as dsFormatCPF,
  formatCNPJ as dsFormatCNPJ,
  formatPhone as dsFormatPhone,
} from '@/lib/design-system';

/**
 * Formata um número para o padrão monetário brasileiro (BRL).
 * @param value O valor numérico a ser formatado.
 * @returns A string formatada, ex: "R$ 1.234,56".
 */
export const formatCurrency = (value: number | null | undefined): string => {
  return dsFormatCurrency(value);
};

/**
 * Formata uma string de CPF (11 dígitos) para o padrão com pontos e traço.
 * @param cpf A string do CPF (apenas dígitos).
 * @returns O CPF formatado (000.000.000-00) ou a string original se inválido.
 */
export const formatCPF = (cpf: string | null | undefined): string => {
  if (!cpf) return '';
  const out = dsFormatCPF(cpf);
  return out === '-' ? '' : out;
};

/**
 * Formata uma string de CNPJ (14 dígitos) para o padrão com pontos, barra e traço.
 * @param cnpj A string do CNPJ (apenas dígitos).
 * @returns O CNPJ formatado (00.000.000/0000-00) ou a string original se inválido.
 */
export const formatCNPJ = (cnpj: string | null | undefined): string => {
  if (!cnpj) return '';
  const out = dsFormatCNPJ(cnpj);
  return out === '-' ? '' : out;
};

/**
 * Formata um objeto Date ou uma string de data para o padrão brasileiro (dd/MM/yyyy).
 * @param date O objeto Date ou a string de data.
 * @returns A data formatada ou uma string vazia se a data for inválida.
 */
export const formatDate = (
  date: Date | string | null | undefined
): string => {
  // Mantém comportamento antigo ('' ao invés de '-') e consistência via timezone UTC
  // para evitar “voltar um dia” em datas sem timezone.
  if (!date) return "";
  try {
    const dateObj = typeof date === "string" ? new Date(date) : date;
    // Adiciona verificação de data válida
    if (isNaN(dateObj.getTime())) {
        return "";
    }
    return new Intl.DateTimeFormat("pt-BR", {
      day: "2-digit",
      month: "2-digit",
      year: "numeric",
      timeZone: "UTC", // Garante consistência independente do fuso do servidor/cliente
    }).format(dateObj);
  } catch (error) {
    console.error("Erro ao formatar data:", error);
    return "";
  }
};

/**
 * Formata uma string de telefone (10 ou 11 dígitos) para o padrão brasileiro.
 * @param phone A string de telefone (apenas dígitos).
 * @returns O telefone formatado ((00) 0000-0000 ou (00) 00000-0000) ou o original.
 */
export const formatPhone = (phone: string | null | undefined): string => {
  if (!phone) return '';
  const out = dsFormatPhone(phone);
  return out === '-' ? '' : out;
};
