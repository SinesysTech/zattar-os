# =============================================================================
# SINESYS - Variáveis de Ambiente
# =============================================================================
# Copie este arquivo para .env.local e preencha os valores
#
# cp .env.example .env.local
# =============================================================================

# -----------------------------------------------------------------------------
# SUPABASE (Obrigatórias)
# -----------------------------------------------------------------------------
NEXT_PUBLIC_SUPABASE_URL=https://seu-projeto.supabase.co
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_OR_ANON_KEY=sua_anon_key
SUPABASE_SECRET_KEY=sua_secret_key

# Supabase Management API (para métricas de Disk IO Budget)
# Obtenha o project_ref da URL (ex: https://abcdefgh.supabase.co → abcdefgh)
# Gere o access_token em: https://supabase.com/dashboard/account/tokens
SUPABASE_PROJECT_REF=seu_project_ref
SUPABASE_ACCESS_TOKEN=seu_access_token

# -----------------------------------------------------------------------------
# AUTENTICAÇÃO DE SISTEMA (Obrigatória)
# -----------------------------------------------------------------------------
# Chave para autenticação entre serviços internos
SERVICE_API_KEY=sua_api_key_segura

# -----------------------------------------------------------------------------
# 2FAUTH - Autenticação 2FA/OTP para PJE (Opcional)
# -----------------------------------------------------------------------------
# Usado para gerar códigos OTP durante autenticação no PJE
TWOFAUTH_API_URL=https://seu-2fauth.com/api/v1
TWOFAUTH_API_TOKEN=seu_token_jwt
TWOFAUTH_ACCOUNT_ID=id_da_conta

# -----------------------------------------------------------------------------
# STORAGE - Backblaze B2 (Opcional)
# -----------------------------------------------------------------------------
# Para upload de documentos do PJE
STORAGE_PROVIDER=backblaze
B2_ENDPOINT=https://s3.us-east-005.backblazeb2.com
B2_REGION=us-east-005
B2_BUCKET=seu-bucket
B2_KEY_ID=seu_key_id
B2_APPLICATION_KEY=sua_application_key


# -----------------------------------------------------------------------------
# AI - CopilotKit e Google Gemini (Opcional)
# -----------------------------------------------------------------------------
# CopilotKit Cloud - Assistente IA
COPILOT_CLOUD_PUBLIC_API_KEY=sua_chave_copilotkit

# Google API Key - Gemini e outros servicos Google
# Obtenha em: https://aistudio.google.com/app/apikey
GOOGLE_API_KEY=sua_chave_google_api

# -----------------------------------------------------------------------------
# AI GATEWAY - Editor de Documentos Plate.js (Obrigatoria para IA do Editor)
# -----------------------------------------------------------------------------
# Chave de API do AI Gateway (Vercel AI Gateway ou similar)
# Usada para funcionalidades de IA no editor de documentos (gerar, editar, comentar)
# Com system prompts especializados em Direito Brasileiro
# Obtenha em: https://vercel.com/docs/ai-gateway
AI_GATEWAY_API_KEY=sua_chave_ai_gateway

# -----------------------------------------------------------------------------
# DYTE - Video/Audio Calls (Obrigatória para Chamadas no Chat)
# -----------------------------------------------------------------------------
# SDK de video conferência para chamadas de áudio e vídeo no módulo de chat
# Obtenha suas credenciais em: https://dev.dyte.io/apikeys
#
# Passos para configurar:
# 1. Registre-se em https://dev.dyte.io
# 2. Crie uma organização no Developer Portal
# 3. Copie o Organization ID e API Key da seção API Keys
#
# NEXT_PUBLIC_DYTE_ORG_ID: ID da organização (público, usado no client-side)
# DYTE_API_KEY: Chave de API (privada, server-side only)
NEXT_PUBLIC_DYTE_ORG_ID=sua_organization_id
DYTE_API_KEY=sua_api_key

# -----------------------------------------------------------------------------
# OPENAI - Embeddings para RAG (Obrigatória para Busca Semântica)
# -----------------------------------------------------------------------------
# Chave de API da OpenAI para geração de embeddings
# Usada para vetorização de documentos e busca semântica inteligente
# Modelo utilizado: text-embedding-3-small (1536 dimensões)
# Obtenha em: https://platform.openai.com/api-keys
# AI Services
OPENAI_API_KEY=sk-...

# -----------------------------------------------------------------------------
# DYTE - Transcrição de Chamadas (Opcional)
# -----------------------------------------------------------------------------
# Habilita transcrição automática em chamadas de vídeo/áudio
# A transcrição é processada pelo Dyte e armazenada no banco
# Resumos são gerados automaticamente usando OpenAI GPT-4
# DYTE_ENABLE_TRANSCRIPTION=true
DYTE_ENABLE_RECORDING=true

# Modelo de embedding a ser utilizado (padrão: text-embedding-3-small)
# Opções: text-embedding-3-small (1536 dims), text-embedding-3-large (3072 dims), text-embedding-ada-002 (1536 dims)
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# -----------------------------------------------------------------------------
# COHERE - Embeddings Alternativo (Opcional)
# -----------------------------------------------------------------------------
# Para usar Cohere em vez de OpenAI, defina AI_EMBEDDING_PROVIDER=cohere
# Obtenha em: https://dashboard.cohere.com/api-keys
# AI_EMBEDDING_PROVIDER=cohere
# COHERE_API_KEY=sua_chave_cohere
# COHERE_EMBEDDING_MODEL=embed-multilingual-v3.0

# -----------------------------------------------------------------------------
# AI INDEXING - Controle de Indexação RAG (Opcional)
# -----------------------------------------------------------------------------
# Habilita/desabilita indexação de documentos para busca semântica
# Em caso de emergência (Disk I/O alto), defina como false
# Padrão: true
ENABLE_AI_INDEXING=true

# -----------------------------------------------------------------------------
# CRON JOBS - Agendamentos Automáticos (Obrigatório para Scheduler)
# -----------------------------------------------------------------------------
# Secret token para autenticar chamadas de cron jobs externos
# Gere um token seguro: openssl rand -hex 32
# Usado pelos endpoints (Cronicle/CapRover, cron-job.org, etc.):
#   - POST /api/cron/executar-agendamentos (scheduler de capturas)
#   - POST /api/cron/verificar-prazos (notificações de prazos)
#   - POST /api/cron/indexar-documentos (indexação RAG)
# Headers aceitos:
#   - Authorization: Bearer <CRON_SECRET>
#   - X-Cron-Secret: <CRON_SECRET>
# Docs: docs/cronicle-caprover.md
CRON_SECRET=seu_cron_secret_seguro

# -----------------------------------------------------------------------------
# DEBUG - Logs de Desenvolvimento (Opcional)
# -----------------------------------------------------------------------------
# Habilita logs legíveis para queries Supabase
# Exemplo: [Supabase] SELECT clientes (nome=JEFFERSON) 200 in 91ms
DEBUG_SUPABASE=false

# -----------------------------------------------------------------------------
# BUILD CACHE - Cache Persistente (Opcional)
# -----------------------------------------------------------------------------
# Habilita logs do cache handler customizado
# Mostra operacoes de get/set/revalidate do cache
# BUILD_CACHE_DEBUG=false

# -----------------------------------------------------------------------------
# REDIS - Cache Distribuído (Opcional)
# -----------------------------------------------------------------------------
# IMPORTANTE: Não inclua a senha na URL. Use REDIS_PASSWORD separadamente.
ENABLE_REDIS_CACHE=true
REDIS_URL=redis://host:6379
REDIS_PASSWORD=sua_senha
REDIS_CACHE_TTL=600
REDIS_CACHE_MAX_MEMORY=256mb
ENABLE_REDIS_LOG_STREAMING=false

# -----------------------------------------------------------------------------
# BROWSER SERVICE - Firefox para Scraping (Produção)
# -----------------------------------------------------------------------------
# Em produção: conecta ao Firefox remoto via WebSocket
# Em desenvolvimento: deixe vazio para usar Firefox local (fallback automático)
#
# Para CapRover:
#   BROWSER_WS_ENDPOINT=ws://srv-captain--sinesys-browser:3000
#   BROWSER_SERVICE_URL=http://srv-captain--sinesys-browser:3000
#
# Para Docker Compose:
#   BROWSER_WS_ENDPOINT=ws://sinesys_browser:3000
#   BROWSER_SERVICE_URL=http://sinesys_browser:3000
# -----------------------------------------------------------------------------
BROWSER_WS_ENDPOINT=
BROWSER_SERVICE_URL=
BROWSER_SERVICE_TOKEN=

# -----------------------------------------------------------------------------
# MCP SERVER - Integração com Agentes IA
# -----------------------------------------------------------------------------
# Configurações para o MCP Server (sinesys-mcp)
#
# Para CapRover:
#   MCP_SINESYS_API_URL=http://srv-captain--sinesys:3000
#
# Para Docker Compose:
#   MCP_SINESYS_API_URL=http://sinesys_app:3000
# -----------------------------------------------------------------------------
MCP_SINESYS_API_URL=http://localhost:3000
# Use o mesmo valor de SERVICE_API_KEY ou uma chave dedicada para o MCP
MCP_SINESYS_API_KEY=sua_api_key_segura

# -----------------------------------------------------------------------------
# SECURITY - Headers de Segurança HTTP
# -----------------------------------------------------------------------------
# Modo report-only para CSP (não bloqueia, apenas reporta violações)
# Defina como false para ativar bloqueio após validação em produção
# Recomendação: manter true por pelo menos 1 semana em produção para identificar
# violações legítimas antes de ativar o modo enforcement
CSP_REPORT_ONLY=true

# URI para relatórios de violação CSP (opcional)
# CSP_REPORT_URI=/api/csp-report

# -----------------------------------------------------------------------------
# CORS - Controle de Origens Permitidas
# -----------------------------------------------------------------------------
# Lista de origens permitidas para requisições CORS (comma-separated)
# Em desenvolvimento, localhost é permitido automaticamente
# Em produção, defina explicitamente os domínios confiáveis
# Exemplo: https://zataradvogados.com,https://app.zataradvogados.com
# ALLOWED_ORIGINS=https://zataradvogados.com

# -----------------------------------------------------------------------------
# RATE LIMITING - Controle de Taxa de Requisições
# -----------------------------------------------------------------------------
# Modo de falha quando Redis está indisponível:
# - 'closed': Bloqueia requisições (mais seguro, padrão)
# - 'open': Permite requisições (mais disponível, menos seguro)
RATE_LIMIT_FAIL_MODE=closed

# -----------------------------------------------------------------------------
# IP BLOCKING - Bloqueio Automático de IPs Suspeitos
# -----------------------------------------------------------------------------
# Habilita/desabilita o sistema de bloqueio automático de IPs
# Padrão: true
IP_BLOCKING_ENABLED=true

# IPs sempre permitidos (comma-separated)
# Estes IPs nunca serão bloqueados automaticamente
IP_WHITELIST=127.0.0.1,::1

# Thresholds para bloqueio automático (opcional - usa padrões se não definido)
# IP_BLOCK_AUTH_FAILURES: Falhas de autenticação antes de bloquear (padrão: 5)
# IP_BLOCK_RATE_LIMIT_ABUSE: Rate limits excedidos antes de bloquear (padrão: 10)
# IP_BLOCK_INVALID_ENDPOINTS: Requisições a endpoints inválidos (padrão: 20)
# IP_BLOCK_AUTH_FAILURES=5
# IP_BLOCK_RATE_LIMIT_ABUSE=10
# IP_BLOCK_INVALID_ENDPOINTS=20

# -----------------------------------------------------------------------------
# CHATWOOT - Plataforma de Comunicação (Opcional)
# -----------------------------------------------------------------------------
# Integração com Chatwoot para centralizar comunicação com clientes e partes
# Obtenha as credenciais em: Settings > Account Settings > API no Chatwoot
#
# CHATWOOT_API_URL: URL base da sua instância Chatwoot
# CHATWOOT_API_KEY: Token de acesso da API (api_access_token)
# CHATWOOT_ACCOUNT_ID: ID numérico da conta
# CHATWOOT_DEFAULT_INBOX_ID: ID do inbox padrão para novos contatos
CHATWOOT_API_URL=https://seu-chatwoot.com
CHATWOOT_API_KEY=seu_api_access_token
CHATWOOT_ACCOUNT_ID=1
CHATWOOT_DEFAULT_INBOX_ID=1

# -----------------------------------------------------------------------------
# ESTRUTURA DE URLs (Baseada em Diretórios)
# -----------------------------------------------------------------------------
# A aplicação usa roteamento baseado em diretórios (não domínios):
#
# - Website:        zataradvogados.com/          (raiz)
# - Dashboard:      zataradvogados.com/app       (requer auth Supabase)
# - Portal Cliente: zataradvogados.com/portal    (requer sessão CPF)
#
# No CapRover: configure apenas UM domínio (zataradvogados.com)
# Todas as rotas funcionam automaticamente via paths

# -----------------------------------------------------------------------------
# SYSTEM AGENT - Configuração do Agente do Sistema
# -----------------------------------------------------------------------------
# ID do usuário que representa o agente do sistema no banco de dados
# Deve corresponder a um usuário de serviço existente
# Padrão: 1
SYSTEM_AGENT_USER_ID=1
